<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css" />
<title>jj07开发文档</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>

<h1 id="toc_1" class="justcenter">JJ07 项目开发 FAQ</h1>

<div class="toc">
<ul>
<li><a href="#toc_1">JJ07 项目开发 FAQ</a></li>
<ul>
<li><a href="#toc_1.1">本文档是做什么的？</a></li>
<li><a href="#toc_1.2">什么是 JJ07 ？</a></li>
<li><a href="#toc_1.3">获取源码前要做哪些准备工作？</a></li>
<li><a href="#toc_1.4">如何获得JJ07项目源码？</a></li>
<li><a href="#toc_1.5">如何编译源码？</a></li>
<li><a href="#toc_1.6">如何上传自己的修改？</a></li>
<li><a href="#toc_1.7">如何与服务器同步？</a></li>
<li><a href="#toc_1.8">如何为JJ07添加一个 git 仓库并使用 repo 管理？</a></li>
</ul>
</ul>
</div>

<h2 id="toc_1.1">本文档是做什么的？</h2>

<p>
本篇介绍 JJ07 项目开发的主要工作流程，以及如何使用 repo 和 git 进行同步开发。
</p>

<h2 id="toc_1.2">什么是 JJ07 ？</h2>

<p>
JJ07 是一个 Android 项目。...
</p>

<p>
代码位于 192.168.40.50:h:/project_repo/JJ07-1/android_mirror
</p>

<h2 id="toc_1.3">获取源码前要做哪些准备工作？</h2>

<ul>
<li>
Linux PC环境。
</li>
<li>
按 <a href="http://source.android.com/source/initializing.html">http://source.android.com/source/initializing.html</a> 搭建主机环境。
</li>
<li>
准备至少15G空间。源码编译后整个工程目录占空间为 11G。
</li>
<li>
确认当前用户有访问 192.168.40.50 的权限。
</li>
</ul>

<h2 id="toc_1.4">如何获得JJ07项目源码？</h2>

<ul>
<li>
建立项目目录
<pre>
 $ mkdir jj07
</pre>
</li>
</ul>

<ul>
<li>
取得 repo 工具， <em><strong>这一步的目的只为获得repo仓库中的repo文件，拿到repo文件之后，整个repo目录可以删除。</strong></em>
<pre>
 git clone [username@]192.168.40.50:h:/project_repo/JJ07-1/android_mirror/repo -b jj07
 cp repo/repo ./jj07/
 rm -rf repo
 cd jj07
</pre>
</li>
</ul>

<p>
<del>注意</del> <strong>本文中 [username@] 是指：</strong>
</p>
<pre>
[username@]这里是指定自己的用户名。使用'[]'括起来表示不一定需要指定此项。
只有当前用户名与之前提交的公钥中的用户名不同时，才需要在这里明确指定公钥中的用户名。
比如，之前提交的公钥中指定的用户名为 spd-smmei，而当前系统登陆用户名不是
spd-smmei，则此时需要指定 spd-smmei@ 。否则不需要指定用户名。
</pre>
  
<ul>
<li>
从服务器下载源代码
<pre>
./repo init -u [username@]192.168.40.50:h:/project_repo/JJ07-1/android_mirror/platform/manifest.git -b jj07
./repo sync
</pre>
</li>
</ul>

<h2 id="toc_1.5">如何编译源码？</h2>

<ul>
<li>
. build/envsetup.sh
</li>
<li>
lunch，选择 9 (imx53_smd-eng)
</li>
<li>
make
</li>
</ul>

<h2 id="toc_1.6">如何上传自己的修改？</h2>

<p>
repo 工具是对 git 的封装，我们内部提交代码到服务器仍然使用 git 对单个 git仓库进行操作。
</p>

<p>
假设想要修改 kernel_imx 中的代码，并将代码上传至服务器，则需要做如下步骤：
</p>

<ul>
<li>
git co -b jj07 aosp/jj07
<br />  建立本地 jj07 分支用于跟踪远程仓库中的 jj07 分支。 <strong>如果之前已经创建过则无需再创建</strong> 。
</li>
</ul>
  
<ul>
<li>
修改代码
</li>
</ul>

<ul>
<li>
git commit 
<br />  将修改提交到本地分支。
</li>
</ul>
  
<ul>
<li>
git pull, git push
<br />  同步服务器中的 kernel_imx 代码，并将自己的修改上传到服务器。
</li>
</ul>

<ul>
<li>
说明：
</li>
</ul>
<p>
./repo sync 之后进入任一源码目录下执行 git branch ，都会看到 
</p>
<pre>
  * (no branch)
</pre>
	
<p>
使用 git branch -r 可以看到当前git仓库的远程分支情况，类似如下：
</p>
<pre>
  aosp/gingerbread
  aosp/gingerbread-mr4-release
  aosp/gingerbread-release
  aosp/imx_r10.3
  aosp/imx_r10.3.1
  aosp/jj07
  aosp/master
  m/jj07 -&gt; aosp/jj07
</pre>
<p>
JJ07 项目开发中，我们跟踪的是 jj07 分支，所以使用 git co -b jj07 aosp/jj07
来创建本地 jj07 分支并跟踪远程 jj07 分支。
</p>

<h2 id="toc_1.7">如何与服务器同步？</h2>

<p>
有三种方法：
</p>

<ul>
<li>
./repo sync
<br />  用于同步.repo/manifest.xml中列出的所有git项目
</li>
</ul>
  
<ul>
<li>
./repo sync [project_name]
<br />  用于同步单个项目，project_name可参见 .repo/manifest.xml。
</li>
</ul>
  
<ul>
<li>
git pull
<br />  进入单个 git 目录中，使用 git pull 来拉取单个git项目代码。
</li>
</ul>

<h2 id="toc_1.8">如何为JJ07添加一个 git 仓库并使用 repo 管理？</h2>

<p>
假设现在有源码fsl想放在 device/fsl 目录下，并使用git 和 repo 管理此目录下的代码。
</p>

<ul>
<li>
进入 <strong>服务器</strong> 相应目录下(platform/device/)建立 fsl.git 目录(使用ssh登陆服务器)
<pre>
  mkdir fsl.git
</pre>
</li>
</ul>

<ul>
<li>
建立仓库
<pre>
  git init --bare
</pre>
</li>
</ul>
    
<ul>
<li>
本机上建立好 fsl 源码的本地仓库，添加远程仓库地址
<pre>
  git remote add aosp [username@]192.168.40.50:h:/project_repo/JJ07-1/android_mirror/device/fsl
</pre>
</li>
</ul>

<ul>
<li>
向服务器推送本地 jj07 分支
<pre>
  git push aosp jj07:jj07
</pre>
</li>
</ul>
    
<ul>
<li>
在 .repo/manifests 下的 default.xml 里添加 fsl 的相应描述
<pre>
  &lt;project path="device/fsl" name="device/fsl" /&gt;
</pre>
</li>
</ul>
  
<ul>
<li>
最后便可在本地 jj07 项目中获取服务器上的 fsl 代码了
<pre>
  ./repo sync device/fsl
</pre>
</li>
</ul>

</body>
</html>
