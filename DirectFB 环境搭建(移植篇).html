<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css" />
<title>DirectFB 环境搭建(移植篇)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<h2 id="toc_0.1">Environment</h2>
<pre>
export PREFIX=/opt/busybox
export LDFLAGS="-L$PREFIX/lib -Wl,-rpath,$PREFIX/lib"
export CFLAGS="-g -I$PREFIX/include"
export PKG_CONFIG_PATH=$PREFIX/lib/pkgconfig
</pre>

<h2 id="toc_0.2">freetype</h2>
<pre>
./configure --host=arm-linux --prefix=/opt/busybox
make
make install
</pre>

<h2 id="toc_0.3">jpeg</h2>
<pre>
./configure --host=arm-linux CC=arm-linux-gcc --prefix=$PREFIX --enable-shared --enable-static
修改生成的Makefile文件:
       # The name of your C compiler:
       CC= gcc  该成  CC=arm-linux-gcc (根据你自己交叉编译器的位置修改)
       # library (.a) file creation command
       AR= ar rc 该成  AR= arm-linux-ar rc  (同上)
       # second step in .a creation (use &amp;quot;touch&amp;quot; if not needed)
       AR2= ranlib 该成  AR2=arm-linux-ranlib (同上)
       
make
make install-lib
</pre>

<h2 id="toc_0.4">zlib</h2>
<pre>
CC=arm-linux-gcc ./configure --prefix=$PREFIX --shared
make
make install
</pre>

<h2 id="toc_0.5">libpng</h2>
<pre>
./configure --host=arm-linux --prefix=$PREFIX
make
make install
</pre>

<h2 id="toc_0.6">DirectFB</h2>
<pre>
./configure --host=arm-linux \
--prefix=$PREFIX \
--with-gfxdrivers=none \
--with-inputdrivers=linuxinput \
--enable-png \
--enable-jpeg \
--disable-tiff \
--enable-zlib \
--enable-sdl=no \
--enable-gif=no \
--disable-video4linux \
--disable-x11 \
--enable-unique \
--sysconfdir=/etc

make
make install
</pre>

<h2 id="toc_0.7">Directfb example</h2>
<pre>
./configure --host=arm-linux --prefix=$PREFIX
make
make install
</pre>

<pre>
(*) DirectFB/Core: Single Application Core. (2012-02-03 05:44) 
(!) DirectFB/fbdev/vt: KD_GRAPHICS failed!
    --&gt; Inappropriate ioctl for device
(!) DirectFB/Core: Could not initialize 'system_core' core!
    --&gt; Initialization error!
(#) DirectFBError [DirectFBCreate() failed]: Initialization error!
</pre>
<p>
执行命令时加上参数 --dfb:no-vt  
</p>

<p>
建立配置文件 /.directfbrc , 内容为
</p>
<pre>
no-vt
linux-input-devices=/dev/event1
</pre>

<h2 id="toc_0.8">keyboard 需要做一点修改</h2>
<p>
inputdrivers/linux_input/linux_input.c
</p>

<p>
get_device_info
</p>
<pre>
	  // add for hs13 keyboard
	  for (i = KEY_RESERVED; i &lt; KEY_MAX; i++)
               if (test_bit( i, keybit ))
                    num_keys++;
</pre>

</body>
</html>
